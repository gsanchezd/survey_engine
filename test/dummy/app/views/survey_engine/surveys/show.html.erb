<div class="survey-container">
  <nav class="survey-breadcrumb">
    <%= link_to "â† Back to Surveys", surveys_path, class: "survey-link" %>
  </nav>

  <header class="survey-header">
    <h1><%= @survey.title %></h1>
    <p><%= @survey.description %></p>
  </header>

  <div class="survey-survey-details">
    <strong>Survey Details:</strong>
    <%= @survey.questions.count %> questions | 
    <%= @survey.participants.count %> participants |
    Status: <span class="survey-status survey-status-<%= @survey.status %>"><%= @survey.status.capitalize %></span>
  </div>

  <% unless @survey.can_receive_responses? %>
    <div class="survey-warning-panel">
      <strong>Notice:</strong> This survey is not currently accepting responses.
    </div>
  <% end %>

  <% if @participant&.completed? %>
    <div class="survey-success-panel">
      <strong>Already Completed!</strong> You have already completed this survey.
      <%= link_to "View Results", completed_survey_path(@survey, email: @email), 
          class: "survey-btn survey-btn-success" %>
    </div>
  <% elsif @survey.can_receive_responses? %>
    <div class="survey-start-panel">
      <h3>Start Survey</h3>
      <p>Please enter your email address to begin:</p>
      
      <%= form_tag start_survey_path(@survey), method: :post, class: "survey-start-form", local: true do %>
        <div class="survey-form-group">
          <%= label_tag :email, "Email Address:", class: "survey-label" %>
          <%= email_field_tag :email, @email, 
              placeholder: "your.email@example.com",
              required: true,
              class: "survey-input" %>
        </div>
        
        <div class="survey-form-group">
          <%= submit_tag "Start Survey", class: "survey-btn survey-btn-success survey-btn-large" %>
        </div>
      <% end %>
    </div>
  <% end %>

  <section class="survey-preview-section">
    <h3>Survey Preview</h3>
    <p class="survey-helper-text">This is what participants will see:</p>
    
    <div class="survey-preview-container">
      <% @questions.each_with_index do |question, index| %>
        <article class="survey-question-preview">
          <h4 class="survey-question-title">
            <%= index + 1 %>. <%= question.title %>
            <% if question.required? %>
              <span class="survey-required">*</span>
            <% end %>
          </h4>
          
          <% if question.description.present? %>
            <p class="survey-question-description"><%= question.description %></p>
          <% end %>
          
          <div class="survey-question-meta">
            <strong>Type:</strong> <%= question.question_type.description %>
            
            <% case question.question_type.name %>
            <% when 'text' %>
              <br><em>Participants will enter free text</em>
            <% when 'scale' %>
              <br><em>Scale from <%= question.scale_min %> (<%= question.scale_min_label %>) to <%= question.scale_max %> (<%= question.scale_max_label %>)</em>
            <% when 'single_choice', 'multiple_choice' %>
              <br><em>Options:</em>
              <ul class="survey-options-preview">
                <% question.options.ordered.each do |option| %>
                  <li>
                    <%= option.option_text %>
                    <% if option.is_other? %>
                      <em class="survey-other-option">(allows custom text)</em>
                    <% end %>
                  </li>
                <% end %>
              </ul>
            <% end %>
          </div>
        </article>
      <% end %>
    </div>
  </section>
</div>
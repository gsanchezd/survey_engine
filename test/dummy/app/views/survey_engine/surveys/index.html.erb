<div class="survey-container">
  <header class="survey-header">
    <h1>Available Surveys</h1>
  </header>

  <% unless @current_email.present? %>
    <div class="survey-info-panel">
      <h3>Welcome!</h3>
      <p>To see your survey completion status and continue any in-progress surveys, please enter your email address:</p>
      
      <%= form_tag surveys_path, method: :get, class: "survey-email-form" do %>
        <div class="survey-form-row">
          <%= email_field_tag :email, params[:email], 
              placeholder: "your.email@example.com",
              class: "survey-email-input" %>
          <%= submit_tag "Set Email", class: "survey-btn survey-btn-primary" %>
        </div>
      <% end %>
      
      <p class="survey-helper-text">
        <em>This helps us track your survey progress and prevent duplicate submissions.</em>
      </p>
    </div>
  <% else %>
    <div class="survey-success-panel">
      <strong>Signed in as:</strong> <%= @current_email %>
      <%= link_to "Change Email", surveys_path, class: "survey-link" %>
    </div>
  <% end %>

  <% if @surveys.any? %>
    <div class="survey-surveys-list">
      <% @surveys.each do |survey| %>
        <article class="survey-survey-card">
          <h2><%= survey.title %></h2>
          <p><%= survey.description %></p>
          
          <div class="survey-survey-meta">
            <span><strong>Questions:</strong> <%= survey.questions.count %></span>
            <span><strong>Participants:</strong> <%= survey.participants.count %></span>
            <span><strong>Status:</strong> <span class="survey-status survey-status-<%= survey.status %>"><%= survey.status.capitalize %></span></span>
          </div>
          
          <div class="survey-survey-actions">
            <% if survey.can_receive_responses? %>
              <% if @current_email.present? && @completed_surveys&.dig(survey.id) %>
                <span class="survey-btn survey-btn-completed">
                  âœ“ Completed
                </span>
                <%= link_to "View My Results", completed_survey_path(survey, email: @current_email), 
                    class: "survey-btn survey-btn-success" %>
              <% else %>
                <% if @current_email.present? %>
                  <%= link_to "Continue Survey", survey_path(survey, email: @current_email), 
                      class: "survey-btn survey-btn-primary" %>
                <% else %>
                  <%= link_to "Take Survey", survey_path(survey), 
                      class: "survey-btn survey-btn-primary" %>
                <% end %>
              <% end %>
            <% else %>
              <span class="survey-text-muted">Survey not available</span>
            <% end %>
            
            <% if survey.participants.any? %>
              <%= link_to "ðŸ“Š View Results", results_survey_path(survey), 
                  class: "survey-btn survey-btn-secondary" %>
            <% else %>
              <span class="survey-btn survey-btn-disabled">ðŸ“Š No results yet</span>
            <% end %>
          </div>
        </article>
      <% end %>
    </div>
  <% else %>
    <div class="survey-empty-state">
      <h3>No surveys available</h3>
      <p>There are no published surveys at the moment.</p>
      <p class="survey-helper-text">You can create surveys using the Rails console or seeds file.</p>
    </div>
  <% end %>
</div>
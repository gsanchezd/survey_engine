<div class="survey-container">
  <div class="survey-breadcrumb">
    <%= link_to "← Back to Surveys", surveys_path %>
  </div>

  <div class="survey-header">
    <h1>📊 Survey Results: <%= @survey.title %></h1>
    <% if @survey.survey_template %>
      <p>Template: <%= @survey.survey_template.name %></p>
    <% end %>
  </div>

  <div class="survey-alert survey-alert-info">
    <h3>📈 Overall Statistics</h3>
    
    <div class="survey-form-row">
      <div class="survey-meta">
        <strong>Total Participants:</strong> <%= @stats[:total_participants] %> | 
        <strong>Completed Responses:</strong> <%= @stats[:completed_responses] %> | 
        <strong>Completion Rate:</strong> <%= @stats[:completion_rate] %>%
      </div>
    </div>
  </div>

  <% if @responses.any? %>
    <div class="survey-list">
      <h2>📋 Question Analysis</h2>
      
      <% @questions.each_with_index do |question, index| %>
        <% analytics = @question_analytics[question.id] %>
        <div class="survey-card">
          <h3>
            <%= index + 1 %>. <%= question.title %>
            <span class="survey-text-muted">(<%= analytics[:response_count] %> responses)</span>
          </h3>
          
          <% if question.description.present? %>
            <p class="survey-text-muted"><%= question.description %></p>
          <% end %>
          
          <div class="survey-details">
            <% case analytics[:type] %>
            <% when 'text' %>
              <strong>Text Responses (<%= analytics[:responses].count %>):</strong>
              <% if analytics[:responses].any? %>
                <ul>
                  <% analytics[:responses].first(10).each do |response| %>
                    <li>"<%= response %>"</li>
                  <% end %>
                  <% if analytics[:responses].count > 10 %>
                    <li class="survey-text-muted">... and <%= analytics[:responses].count - 10 %> more responses</li>
                  <% end %>
                </ul>
              <% else %>
                <p class="survey-text-muted">No text responses yet.</p>
              <% end %>
              
            <% when 'numeric' %>
              <div class="survey-form-row">
                <div class="survey-meta">
                  <strong>Average:</strong> <%= analytics[:average] %> | 
                  <strong>Min:</strong> <%= analytics[:min] %> | 
                  <strong>Max:</strong> <%= analytics[:max] %>
                </div>
              </div>
              
              <% if analytics[:distribution].any? %>
                <strong>Response Distribution:</strong>
                <ul>
                  <% analytics[:distribution].sort.each do |value, count| %>
                    <li><%= value %>: <%= count %> responses (<%= (count.to_f / analytics[:response_count] * 100).round(1) %>%)</li>
                  <% end %>
                </ul>
              <% end %>
              
            <% when 'boolean' %>
              <div class="survey-form-row">
                <div class="survey-meta">
                  <strong><%= t('survey_engine.surveys.answer.yes') %>:</strong> <%= analytics[:yes_count] %> (<%= analytics[:yes_percentage] %>%) | 
                  <strong><%= t('survey_engine.surveys.answer.no') %>:</strong> <%= analytics[:no_count] %> (<%= (100 - analytics[:yes_percentage]).round(1) %>%)
                </div>
              </div>
              
            <% when 'choice' %>
              <% if analytics[:option_counts].any? %>
                <strong>Option Selection:</strong>
                <ul>
                  <% analytics[:option_counts].sort_by { |_, count| -count }.each do |option_text, count| %>
                    <li><%= option_text %>: <%= count %> responses (<%= (count.to_f / analytics[:response_count] * 100).round(1) %>%)</li>
                  <% end %>
                </ul>
              <% end %>
              
              <% if analytics[:other_responses].any? %>
                <strong>"Other" Responses:</strong>
                <ul>
                  <% analytics[:other_responses].first(5).each do |other_response| %>
                    <li>"<%= other_response %>"</li>
                  <% end %>
                  <% if analytics[:other_responses].count > 5 %>
                    <li class="survey-text-muted">... and <%= analytics[:other_responses].count - 5 %> more "other" responses</li>
                  <% end %>
                </ul>
              <% end %>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
    
    <div class="survey-alert survey-alert-info">
      <h3>📥 Export Results</h3>
      <p>Download survey data for further analysis</p>
      
      <div class="survey-actions">
        <%= link_to "Download CSV", results_survey_path(@survey, format: :csv), 
            class: "survey-btn survey-btn-success" %>
        <%= link_to "Download JSON", results_survey_path(@survey, format: :json), 
            class: "survey-btn survey-btn-primary" %>
      </div>
    </div>
    
  <% else %>
    <div class="survey-empty-state">
      <h3>📭 No Responses Yet</h3>
      <p>This survey hasn't received any completed responses yet.</p>
      <p class="survey-helper-text">Once participants start completing the survey, their results will appear here.</p>
    </div>
  <% end %>
</div>